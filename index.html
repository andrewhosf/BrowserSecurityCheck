<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visitor Information</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .info-card {
            background-color: #f8f9fa;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .info-card h2 {
            margin-top: 0;
            color: #007bff;
            font-size: 1.2em;
        }
        .info-card p {
            margin: 10px 0;
            color: #555;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .security-status {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-safe {
            background-color: #d4edda;
            color: #155724;
        }
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        .status-danger {
            background-color: #f8d7da;
            color: #721c24;
        }
        .security-details {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }
        .vulnerability-list {
            list-style: none;
            padding: 0;
            margin: 10px 0;
        }
        .vulnerability-item {
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .severity-high {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .severity-medium {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        .severity-low {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        .scan-progress {
            width: 100%;
            height: 4px;
            background-color: #e9ecef;
            border-radius: 2px;
            margin: 10px 0;
        }
        .scan-progress-bar {
            height: 100%;
            background-color: #007bff;
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        .compliance-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .compliance-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .compliance-icon {
            margin-right: 10px;
            font-size: 1.2em;
        }
        .compliance-status {
            margin-left: auto;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .compliance-details {
            margin-left: 30px;
            font-size: 0.9em;
        }
        .requirement-item {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #ddd;
        }
        .requirement-met {
            border-left-color: #28a745;
        }
        .requirement-failed {
            border-left-color: #dc3545;
        }
        .requirement-warning {
            border-left-color: #ffc107;
        }
        .remediation-guide {
            margin-top: 10px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .remediation-guide h5 {
            margin: 0 0 5px 0;
            color: #495057;
        }
        .remediation-steps {
            margin: 0;
            padding-left: 20px;
        }
        .remediation-steps li {
            margin: 3px 0;
        }
        .documentation-links {
            margin-top: 5px;
            font-size: 0.85em;
        }
        .documentation-links a {
            color: #0066cc;
            text-decoration: none;
        }
        .documentation-links a:hover {
            text-decoration: underline;
        }
        .compliance-reference {
            font-size: 0.8em;
            color: #6c757d;
            margin-top: 5px;
        }
        .map-container {
            height: 300px;
            width: 100%;
            margin: 15px 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .location-details {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .location-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .location-item {
            padding: 8px;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .location-item strong {
            color: #495057;
            display: block;
            margin-bottom: 4px;
        }
        .accordion {
            margin: 30px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.07);
            background: #fff;
        }
        .accordion-header {
            cursor: pointer;
            padding: 18px 24px;
            font-size: 1.3em;
            font-weight: 600;
            background: #f0f4f8;
            border-radius: 10px 10px 0 0;
            display: flex;
            align-items: center;
            user-select: none;
            transition: background 0.2s;
        }
        .accordion-header:hover {
            background: #e2e8f0;
        }
        .accordion-arrow {
            margin-right: 12px;
            font-size: 1.2em;
            transition: transform 0.2s;
        }
        .accordion-content {
            padding: 0 24px 24px 24px;
            display: none;
        }
        .accordion.open .accordion-content {
            display: block;
        }
        .accordion.open .accordion-arrow {
            transform: rotate(90deg);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Visitor Information</h1>
        
        <!-- Security Panel -->
        <div class="accordion open" id="security-panel">
            <div class="accordion-header" onclick="toggleAccordion('security-panel')">
                <span class="accordion-arrow">&#9654;</span> Security
            </div>
            <div class="accordion-content">
                <div class="info-card">
                    <h2>IP Address</h2>
                    <p id="ip-address" class="loading">Loading...</p>
                </div>
                <div class="info-card">
                    <h2>Browser Information</h2>
                    <p id="browser-info" class="loading">Loading...</p>
                </div>
                <div class="info-card">
                    <h2>Geolocation</h2>
                    <p id="geolocation" class="loading">Loading...</p>
                    <div id="map" class="map-container"></div>
                </div>
                <div class="info-card">
                    <h2>Security Scan</h2>
                    <p id="security-scan" class="loading">Loading security scan...</p>
                </div>
            </div>
        </div>

        <!-- Privacy Panel -->
        <div class="accordion" id="privacy-panel">
            <div class="accordion-header" onclick="toggleAccordion('privacy-panel')">
                <span class="accordion-arrow">&#9654;</span> Privacy
            </div>
            <div class="accordion-content">
                <div class="info-card">
                    <h2>Cookies</h2>
                    <div style="margin-bottom:8px;color:#888;font-size:0.95em;">
                        <span style="background:#e7f4e4;color:#256029;padding:2px 8px;border-radius:12px;font-size:0.9em;margin-right:8px;">First-party</span>
                        Only cookies set by this site (first-party) are accessible and shown below. Third-party cookies are not accessible via JavaScript.
                    </div>
                    <div id="cookie-list" class="loading">Loading cookies...</div>
                </div>
                <div class="info-card">
                    <h2>Privacy Protection</h2>
                    <div id="privacy-protection-list" class="loading">Loading privacy details...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Function to get IP address
        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                document.getElementById('ip-address').textContent = data.ip;
            } catch (error) {
                document.getElementById('ip-address').textContent = 'Unable to fetch IP address';
            }
        }

        // Function to get browser information
        function getBrowserInfo() {
            const userAgent = navigator.userAgent;
            const browserInfo = {
                userAgent: userAgent,
                language: navigator.language,
                platform: navigator.platform,
                screenResolution: `${window.screen.width}x${window.screen.height}`
            };
            
            document.getElementById('browser-info').innerHTML = `
                User Agent: ${browserInfo.userAgent}<br>
                Language: ${browserInfo.language}<br>
                Platform: ${browserInfo.platform}<br>
                Screen Resolution: ${browserInfo.screenResolution}
            `;
        }

        // Function to get geolocation
        function getGeolocation() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const { latitude, longitude, accuracy } = position.coords;
                        
                        try {
                            // Get address information using reverse geocoding
                            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);
                            const data = await response.json();
                            
                            // Initialize the map
                            const map = new google.maps.Map(document.getElementById('map'), {
                                center: { lat: latitude, lng: longitude },
                                zoom: 15,
                                styles: [
                                    {
                                        "featureType": "all",
                                        "elementType": "geometry",
                                        "stylers": [{"color": "#f5f5f5"}]
                                    },
                                    {
                                        "featureType": "water",
                                        "elementType": "geometry",
                                        "stylers": [{"color": "#e9e9e9"}, {"lightness": 17}]
                                    }
                                ]
                            });

                            // Add marker
                            new google.maps.Marker({
                                position: { lat: latitude, lng: longitude },
                                map: map,
                                title: 'Your Location'
                            });

                            // Add accuracy circle
                            new google.maps.Circle({
                                strokeColor: '#FF0000',
                                strokeOpacity: 0.8,
                                strokeWeight: 2,
                                fillColor: '#FF0000',
                                fillOpacity: 0.35,
                                map: map,
                                center: { lat: latitude, lng: longitude },
                                radius: accuracy
                            });

                            // Display location information
                            document.getElementById('geolocation').innerHTML = `
                                <div class="location-details">
                                    <div class="location-info">
                                        <div class="location-item">
                                            <strong>Address</strong>
                                            ${data.display_name || 'Not available'}
                                        </div>
                                        <div class="location-item">
                                            <strong>Coordinates</strong>
                                            ${latitude.toFixed(6)}, ${longitude.toFixed(6)}
                                        </div>
                                        <div class="location-item">
                                            <strong>Accuracy</strong>
                                            ${accuracy.toFixed(2)} meters
                                        </div>
                                        <div class="location-item">
                                            <strong>City</strong>
                                            ${data.address?.city || data.address?.town || data.address?.village || 'Not available'}
                                        </div>
                                        <div class="location-item">
                                            <strong>State/Province</strong>
                                            ${data.address?.state || 'Not available'}
                                        </div>
                                        <div class="location-item">
                                            <strong>Country</strong>
                                            ${data.address?.country || 'Not available'}
                                        </div>
                                    </div>
                                </div>
                            `;
                        } catch (error) {
                            console.error('Error getting address information:', error);
                            document.getElementById('geolocation').innerHTML = `
                                <div class="location-details">
                                    <div class="location-info">
                                        <div class="location-item">
                                            <strong>Coordinates</strong>
                                            ${latitude.toFixed(6)}, ${longitude.toFixed(6)}
                                        </div>
                                        <div class="location-item">
                                            <strong>Accuracy</strong>
                                            ${accuracy.toFixed(2)} meters
                                        </div>
                                    </div>
                                </div>
                            `;
                        }
                    },
                    (error) => {
                        document.getElementById('geolocation').textContent = 'Geolocation access denied';
                    }
                );
            } else {
                document.getElementById('geolocation').textContent = 'Geolocation not supported';
            }
        }

        // Function to check security headers
        function checkSecurityHeaders() {
            const headers = {
                'Content-Security-Policy': 'Not Detected',
                'X-Frame-Options': 'Not Detected',
                'X-Content-Type-Options': 'Not Detected',
                'Strict-Transport-Security': 'Not Detected'
            };

            // In a real implementation, these would be checked server-side
            // This is a simulation for demonstration
            return headers;
        }

        // Enhanced browser security check
        function checkBrowserSecurity() {
            const security = {
                'WebRTC Leak': navigator.mediaDevices ? 'Potential Risk' : 'Safe',
                'Do Not Track': navigator.doNotTrack ? 'Enabled' : 'Disabled',
                'Cookies Enabled': navigator.cookieEnabled ? 'Enabled' : 'Disabled',
                'Private Browsing': window.webkitRequestFileSystem ? 'Not Detected' : 'Potentially Enabled',
                'JavaScript Enabled': 'Enabled',
                'Local Storage': window.localStorage ? 'Available' : 'Not Available',
                'Session Storage': window.sessionStorage ? 'Available' : 'Not Available',
                'IndexedDB': window.indexedDB ? 'Available' : 'Not Available',
                'WebGL': detectWebGL() ? 'Available' : 'Not Available',
                'Canvas Fingerprinting': detectCanvasFingerprinting() ? 'Vulnerable' : 'Protected',
                'Audio Fingerprinting': detectAudioFingerprinting() ? 'Vulnerable' : 'Protected',
                'Font Fingerprinting': detectFontFingerprinting() ? 'Vulnerable' : 'Protected'
            };
            return security;
        }

        // Check for WebGL support
        function detectWebGL() {
            try {
                const canvas = document.createElement('canvas');
                return !!(window.WebGLRenderingContext && 
                    (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
            } catch (e) {
                return false;
            }
        }

        // Check for Canvas Fingerprinting vulnerability
        function detectCanvasFingerprinting() {
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = "top";
                ctx.font = "14px 'Arial'";
                ctx.textBaseline = "alphabetic";
                ctx.fillStyle = "#f60";
                ctx.fillRect(125,1,62,20);
                ctx.fillStyle = "#069";
                ctx.fillText("Hello, world!", 2, 15);
                ctx.fillStyle = "rgba(102, 204, 0, 0.7)";
                ctx.fillText("Hello, world!", 4, 17);
                return true;
            } catch (e) {
                return false;
            }
        }

        // Check for Audio Fingerprinting vulnerability
        function detectAudioFingerprinting() {
            try {
                return !!(window.AudioContext || window.webkitAudioContext);
            } catch (e) {
                return false;
            }
        }

        // Check for Font Fingerprinting vulnerability
        function detectFontFingerprinting() {
            return 'fonts' in document;
        }

        // Enhanced network security check
        function checkNetworkSecurity() {
            const security = {
                'Connection Type': navigator.connection ? navigator.connection.effectiveType : 'Unknown',
                'Downlink': navigator.connection ? `${navigator.connection.downlink} Mbps` : 'Unknown',
                'RTT': navigator.connection ? `${navigator.connection.rtt} ms` : 'Unknown',
                'Save Data': navigator.connection ? (navigator.connection.saveData ? 'Enabled' : 'Disabled') : 'Unknown',
                'Protocol': window.location.protocol,
                'Mixed Content': detectMixedContent() ? 'Detected' : 'Not Detected',
                'DNS Leak': 'Not Detected', // Would require actual DNS leak test
                'WebRTC Leak': detectWebRTCLeak() ? 'Detected' : 'Not Detected'
            };
            return security;
        }

        // Check for mixed content
        function detectMixedContent() {
            if (window.location.protocol === 'https:') {
                const images = document.getElementsByTagName('img');
                for (let img of images) {
                    if (img.src.startsWith('http:')) {
                        return true;
                    }
                }
            }
            return false;
        }

        // Check for WebRTC leaks
        function detectWebRTCLeak() {
            return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
        }

        // Enhanced privacy check
        function checkPrivacy() {
            const privacy = {
                'Third-Party Cookies': detectThirdPartyCookies() ? 'Enabled' : 'Disabled',
                'Tracking Protection': detectTrackingProtection() ? 'Enabled' : 'Disabled',
                'Ad Blockers': detectAdBlockers() ? 'Detected' : 'Not Detected',
                'Social Media Trackers': detectSocialTrackers() ? 'Detected' : 'Not Detected',
                'Analytics Trackers': detectAnalytics() ? 'Detected' : 'Not Detected'
            };
            return privacy;
        }

        // Check for third-party cookies
        function detectThirdPartyCookies() {
            return navigator.cookieEnabled;
        }

        // Check for tracking protection
        function detectTrackingProtection() {
            return navigator.doNotTrack === "1" || navigator.doNotTrack === "yes";
        }

        // Check for ad blockers
        function detectAdBlockers() {
            return new Promise((resolve) => {
                const testAd = document.createElement('div');
                testAd.innerHTML = '&nbsp;';
                testAd.className = 'adsbox';
                document.body.appendChild(testAd);
                window.setTimeout(() => {
                    if (testAd.offsetHeight === 0) {
                        resolve(true);
                    } else {
                        resolve(false);
                    }
                    document.body.removeChild(testAd);
                }, 100);
            });
        }

        // Check for social media trackers
        function detectSocialTrackers() {
            const socialScripts = [
                'facebook.com',
                'twitter.com',
                'linkedin.com',
                'pinterest.com'
            ];
            return socialScripts.some(domain => 
                Array.from(document.scripts).some(script => 
                    script.src.includes(domain)
                )
            );
        }

        // Check for analytics trackers
        function detectAnalytics() {
            const analyticsScripts = [
                'google-analytics.com',
                'analytics.google.com',
                'googletagmanager.com'
            ];
            return analyticsScripts.some(domain => 
                Array.from(document.scripts).some(script => 
                    script.src.includes(domain)
                )
            );
        }

        // Add remediation guides
        const remediationGuides = {
            'PCI-DSS': {
                'Firewall Configuration': {
                    steps: [
                        'Implement and maintain a firewall configuration to protect cardholder data',
                        'Restrict connections between untrusted networks and system components',
                        'Document all firewall rules and review them quarterly'
                    ],
                    docs: [
                        { name: 'PCI DSS Requirements', url: 'https://www.pcisecuritystandards.org/document_library' },
                        { name: 'Firewall Guidelines', url: 'https://www.pcisecuritystandards.org/pdfs/pci_firewall_supplement.pdf' }
                    ]
                },
                'Encryption': {
                    steps: [
                        'Implement strong encryption for transmission of cardholder data',
                        'Use TLS 1.2 or higher for all connections',
                        'Disable weak encryption protocols and ciphers'
                    ],
                    docs: [
                        { name: 'Encryption Guidelines', url: 'https://www.pcisecuritystandards.org/pdfs/pci_ssc_quick_reference_guide.pdf' }
                    ]
                }
            },
            'GDPR': {
                'Consent Management': {
                    steps: [
                        'Implement clear consent collection mechanisms',
                        'Store consent records with timestamps',
                        'Provide easy opt-out options'
                    ],
                    docs: [
                        { name: 'GDPR Consent Guidelines', url: 'https://gdpr.eu/consent/' },
                        { name: 'Article 7', url: 'https://gdpr-info.eu/art-7-gdpr/' }
                    ]
                },
                'Data Minimization': {
                    steps: [
                        'Review and document all data collection points',
                        'Implement data retention policies',
                        'Regularly audit stored data'
                    ],
                    docs: [
                        { name: 'Data Minimization Guide', url: 'https://gdpr.eu/data-minimization/' }
                    ]
                }
            },
            'HIPAA': {
                'PHI Protection': {
                    steps: [
                        'Implement encryption for PHI at rest and in transit',
                        'Establish access controls and audit logs',
                        'Regular security risk assessments'
                    ],
                    docs: [
                        { name: 'HIPAA Security Rule', url: 'https://www.hhs.gov/hipaa/for-professionals/security/index.html' }
                    ]
                }
            },
            'SOC2': {
                'System Operations': {
                    steps: [
                        'Document system operations procedures',
                        'Implement change management process',
                        'Regular system monitoring and logging'
                    ],
                    docs: [
                        { name: 'SOC 2 Guide', url: 'https://www.aicpa.org/interestareas/frc/assuranceadvisoryservices/aicpasoc2report.html' }
                    ]
                }
            },
            'ISO27001': {
                'Risk Assessment': {
                    steps: [
                        'Conduct regular risk assessments',
                        'Document risk treatment plans',
                        'Review and update risk register'
                    ],
                    docs: [
                        { name: 'ISO 27001 Controls', url: 'https://www.iso.org/isoiec-27001-information-security.html' }
                    ]
                }
            }
        };

        // Add documentation references
        const complianceDocs = {
            'PCI-DSS': {
                main: 'https://www.pcisecuritystandards.org/document_library',
                requirements: 'https://www.pcisecuritystandards.org/pdfs/pci_dss_v3-2-1.pdf',
                quickGuide: 'https://www.pcisecuritystandards.org/pdfs/pci_ssc_quick_reference_guide.pdf'
            },
            'GDPR': {
                main: 'https://gdpr.eu/',
                text: 'https://gdpr-info.eu/',
                guidelines: 'https://ec.europa.eu/info/law/law-topic/data-protection_en'
            },
            'HIPAA': {
                main: 'https://www.hhs.gov/hipaa/index.html',
                security: 'https://www.hhs.gov/hipaa/for-professionals/security/index.html',
                privacy: 'https://www.hhs.gov/hipaa/for-professionals/privacy/index.html'
            },
            'SOC2': {
                main: 'https://www.aicpa.org/interestareas/frc/assuranceadvisoryservices/aicpasoc2report.html',
                guide: 'https://www.aicpa.org/content/dam/aicpa/interestareas/frc/assuranceadvisoryservices/downloadabledocuments/trust-services-criteria.pdf'
            },
            'ISO27001': {
                main: 'https://www.iso.org/isoiec-27001-information-security.html',
                controls: 'https://www.iso.org/isoiec-27001-information-security.html',
                guide: 'https://www.iso.org/iso-27001-information-security.html'
            }
        };

        // Compliance check functions
        function checkPCICompliance() {
            const compliance = {
                'PCI-DSS Requirements': {
                    'Network Security': {
                        'Firewall Configuration': {
                            ...checkFirewallConfig(),
                            remediation: remediationGuides['PCI-DSS']['Firewall Configuration']
                        },
                        'Default Passwords': {
                            ...checkDefaultPasswords(),
                            remediation: {
                                steps: [
                                    'Change all default passwords',
                                    'Implement password policy',
                                    'Regular password audits'
                                ],
                                docs: remediationGuides['PCI-DSS']['Firewall Configuration'].docs
                            }
                        },
                        'System Hardening': {
                            ...checkSystemHardening(),
                            remediation: {
                                steps: [
                                    'Remove unnecessary services',
                                    'Apply security patches',
                                    'Configure secure settings'
                                ],
                                docs: remediationGuides['PCI-DSS']['Firewall Configuration'].docs
                            }
                        }
                    },
                    'Data Protection': {
                        'Encryption': {
                            ...checkEncryption(),
                            remediation: remediationGuides['PCI-DSS']['Encryption']
                        },
                        'Card Data Storage': {
                            ...checkCardDataStorage(),
                            remediation: {
                                steps: [
                                    'Implement secure storage mechanisms',
                                    'Encrypt stored card data',
                                    'Regular security audits'
                                ],
                                docs: remediationGuides['PCI-DSS']['Encryption'].docs
                            }
                        },
                        'Secure Transmission': {
                            ...checkSecureTransmission(),
                            remediation: remediationGuides['PCI-DSS']['Encryption']
                        }
                    }
                }
            };
            return compliance;
        }

        function checkGDPRCompliance() {
            return {
                'GDPR Requirements': {
                    'Data Protection': {
                        'Consent Management': checkConsentManagement(),
                        'Data Minimization': checkDataMinimization(),
                        'Right to be Forgotten': checkRightToBeForgotten()
                    },
                    'Privacy Rights': {
                        'Data Portability': checkDataPortability(),
                        'Privacy Notices': checkPrivacyNotices(),
                        'Data Breach Notification': checkBreachNotification()
                    }
                }
            };
        }

        function checkHIPAACompliance() {
            return {
                'HIPAA Requirements': {
                    'Privacy Rule': {
                        'PHI Protection': checkPHIProtection(),
                        'Patient Rights': checkPatientRights(),
                        'Privacy Practices': checkPrivacyPractices()
                    },
                    'Security Rule': {
                        'Access Controls': checkAccessControls(),
                        'Audit Controls': checkAuditControls(),
                        'Transmission Security': checkTransmissionSecurity()
                    }
                }
            };
        }

        function checkSOC2Compliance() {
            return {
                'SOC 2 Requirements': {
                    'Security': {
                        'System Operations': checkSystemOperations(),
                        'Logical Access': checkLogicalAccess(),
                        'System Monitoring': checkSystemMonitoring()
                    },
                    'Availability': {
                        'Disaster Recovery': checkDisasterRecovery(),
                        'Business Continuity': checkBusinessContinuity()
                    }
                }
            };
        }

        function checkISO27001Compliance() {
            return {
                'ISO 27001 Requirements': {
                    'Information Security': {
                        'Risk Assessment': checkRiskAssessment(),
                        'Asset Management': checkAssetManagement(),
                        'Incident Management': checkIncidentManagement()
                    },
                    'Controls': {
                        'Access Control': checkISOAccessControl(),
                        'Cryptography': checkCryptography(),
                        'Operations Security': checkOperationsSecurity()
                    }
                }
            };
        }

        // Helper functions for compliance checks
        function checkFirewallConfig() {
            return {
                status: 'warning',
                details: 'Firewall configuration cannot be verified client-side'
            };
        }

        function checkDefaultPasswords() {
            return {
                status: 'warning',
                details: 'Default password check requires server-side verification'
            };
        }

        function checkSystemHardening() {
            return {
                status: 'warning',
                details: 'System hardening check requires server-side verification'
            };
        }

        function checkEncryption() {
            return {
                status: window.location.protocol === 'https:' ? 'met' : 'failed',
                details: window.location.protocol === 'https:' ? 
                    'HTTPS encryption is enabled' : 
                    'HTTPS encryption is not enabled'
            };
        }

        function checkCardDataStorage() {
            return {
                status: 'warning',
                details: 'Card data storage check requires server-side verification'
            };
        }

        function checkSecureTransmission() {
            return {
                status: window.location.protocol === 'https:' ? 'met' : 'failed',
                details: window.location.protocol === 'https:' ? 
                    'Secure transmission is enabled' : 
                    'Secure transmission is not enabled'
            };
        }

        function checkAuthentication() {
            return {
                status: 'warning',
                details: 'Authentication check requires server-side verification'
            };
        }

        function checkAuthorization() {
            return {
                status: 'warning',
                details: 'Authorization check requires server-side verification'
            };
        }

        function checkPhysicalSecurity() {
            return {
                status: 'warning',
                details: 'Physical security check requires on-site verification'
            };
        }

        // GDPR specific checks
        function checkConsentManagement() {
            return {
                status: 'warning',
                details: 'Consent management check requires server-side verification'
            };
        }

        function checkDataMinimization() {
            return {
                status: 'warning',
                details: 'Data minimization check requires server-side verification'
            };
        }

        function checkRightToBeForgotten() {
            return {
                status: 'warning',
                details: 'Right to be forgotten check requires server-side verification'
            };
        }

        function checkDataPortability() {
            return {
                status: 'warning',
                details: 'Data portability check requires server-side verification'
            };
        }

        function checkPrivacyNotices() {
            return {
                status: 'warning',
                details: 'Privacy notices check requires server-side verification'
            };
        }

        function checkBreachNotification() {
            return {
                status: 'warning',
                details: 'Breach notification check requires server-side verification'
            };
        }

        // Enhanced SSL/TLS check function
        function checkSSL() {
            try {
                const protocol = window.location.protocol;
                const isSecure = protocol === 'https:';
                
                // Get TLS version if available
                let tlsVersion = 'Unknown';
                if (window.performance && window.performance.getEntriesByType) {
                    const entries = window.performance.getEntriesByType('resource');
                    const secureEntries = entries.filter(entry => entry.nextHopProtocol);
                    if (secureEntries.length > 0) {
                        tlsVersion = secureEntries[0].nextHopProtocol;
                    }
                }

                // Check for mixed content
                const hasMixedContent = document.querySelectorAll('img[src^="http:"], script[src^="http:"], link[href^="http:"]').length > 0;

                return {
                    status: isSecure ? 'Secure' : 'Not Secure',
                    details: {
                        protocol: protocol,
                        tlsVersion: tlsVersion,
                        mixedContent: hasMixedContent ? 'Detected' : 'Not Detected'
                    }
                };
            } catch (error) {
                console.error('Error checking SSL:', error);
                return {
                    status: 'Error',
                    details: {
                        protocol: 'Unknown',
                        tlsVersion: 'Unknown',
                        mixedContent: 'Unknown'
                    }
                };
            }
        }

        // Enhanced security scan function with better error handling
        async function performSecurityScan() {
            const securityScan = document.getElementById('security-scan');
            let securityStatus = '';
            const progressBar = document.createElement('div');
            progressBar.className = 'scan-progress';
            progressBar.innerHTML = '<div class="scan-progress-bar" style="width: 0%"></div>';
            securityScan.appendChild(progressBar);

            try {
                // Simulate scanning progress
                for (let i = 0; i <= 100; i += 20) {
                    progressBar.querySelector('.scan-progress-bar').style.width = `${i}%`;
                    await new Promise(resolve => setTimeout(resolve, 200));
                }

                // Get all security information with individual try-catch blocks
                let headers, browserSecurity, networkSecurity, privacy, sslStatus;
                let pciCompliance, gdprCompliance, hipaaCompliance, soc2Compliance, iso27001Compliance;

                try {
                    headers = checkSecurityHeaders();
                } catch (error) {
                    console.error('Error checking security headers:', error);
                    headers = { 'Error': 'Unable to check security headers' };
                }

                try {
                    browserSecurity = checkBrowserSecurity();
                } catch (error) {
                    console.error('Error checking browser security:', error);
                    browserSecurity = { 'Error': 'Unable to check browser security' };
                }

                try {
                    networkSecurity = checkNetworkSecurity();
                } catch (error) {
                    console.error('Error checking network security:', error);
                    networkSecurity = { 'Error': 'Unable to check network security' };
                }

                try {
                    privacy = await checkPrivacy();
                } catch (error) {
                    console.error('Error checking privacy:', error);
                    privacy = { 'Error': 'Unable to check privacy settings' };
                }

                try {
                    sslStatus = checkSSL();
                } catch (error) {
                    console.error('Error checking SSL:', error);
                    sslStatus = {
                        status: 'Error',
                        details: {
                            protocol: 'Unknown',
                            tlsVersion: 'Unknown',
                            mixedContent: 'Unknown'
                        }
                    };
                }

                // Get compliance information with individual try-catch blocks
                try {
                    pciCompliance = checkPCICompliance();
                } catch (error) {
                    console.error('Error checking PCI compliance:', error);
                    pciCompliance = { 'PCI-DSS Requirements': { 'Error': 'Unable to check PCI compliance' } };
                }

                try {
                    gdprCompliance = checkGDPRCompliance();
                } catch (error) {
                    console.error('Error checking GDPR compliance:', error);
                    gdprCompliance = { 'GDPR Requirements': { 'Error': 'Unable to check GDPR compliance' } };
                }

                try {
                    hipaaCompliance = checkHIPAACompliance();
                } catch (error) {
                    console.error('Error checking HIPAA compliance:', error);
                    hipaaCompliance = { 'HIPAA Requirements': { 'Error': 'Unable to check HIPAA compliance' } };
                }

                try {
                    soc2Compliance = checkSOC2Compliance();
                } catch (error) {
                    console.error('Error checking SOC2 compliance:', error);
                    soc2Compliance = { 'SOC 2 Requirements': { 'Error': 'Unable to check SOC2 compliance' } };
                }

                try {
                    iso27001Compliance = checkISO27001Compliance();
                } catch (error) {
                    console.error('Error checking ISO27001 compliance:', error);
                    iso27001Compliance = { 'ISO 27001 Requirements': { 'Error': 'Unable to check ISO27001 compliance' } };
                }

                // Compile enhanced security report
                securityStatus = `
                    <div>
                        <strong>SSL/TLS Status:</strong> 
                        <span class="security-status ${sslStatus.status === 'Secure' ? 'status-safe' : 
                            sslStatus.status === 'Not Secure' ? 'status-danger' : 'status-warning'}">
                            ${sslStatus.status}
                        </span>
                        <div class="security-details">
                            <ul class="vulnerability-list">
                                <li class="vulnerability-item ${sslStatus.details.protocol === 'https:' ? 'severity-low' : 'severity-high'}">
                                    Protocol: ${sslStatus.details.protocol}
                                </li>
                                <li class="vulnerability-item ${sslStatus.details.tlsVersion !== 'Unknown' ? 'severity-low' : 'severity-medium'}">
                                    TLS Version: ${sslStatus.details.tlsVersion}
                                </li>
                                <li class="vulnerability-item ${sslStatus.details.mixedContent === 'Not Detected' ? 'severity-low' : 'severity-high'}">
                                    Mixed Content: ${sslStatus.details.mixedContent}
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="security-details">
                        <strong>Browser Security:</strong>
                        <ul class="vulnerability-list">
                            ${Object.entries(browserSecurity).map(([key, value]) => `
                                <li class="vulnerability-item ${value.includes('Vulnerable') ? 'severity-high' : 
                                    value.includes('Risk') ? 'severity-medium' : 'severity-low'}">
                                    ${key}: ${value}
                                </li>
                            `).join('')}
                        </ul>
                    </div>

                    <div class="security-details">
                        <strong>Network Security:</strong>
                        <ul class="vulnerability-list">
                            ${Object.entries(networkSecurity).map(([key, value]) => `
                                <li class="vulnerability-item ${value.includes('Detected') ? 'severity-high' : 'severity-low'}">
                                    ${key}: ${value}
                                </li>
                            `).join('')}
                        </ul>
                    </div>

                    <div class="security-details">
                        <strong>Privacy Protection:</strong>
                        <ul class="vulnerability-list">
                            ${Object.entries(privacy).map(([key, value]) => `
                                <li class="vulnerability-item ${value.includes('Detected') ? 'severity-high' : 
                                    value.includes('Enabled') ? 'severity-medium' : 'severity-low'}">
                                    ${key}: ${value}
                                </li>
                            `).join('')}
                        </ul>
                    </div>

                    <div class="security-details">
                        <strong>Security Headers:</strong>
                        <ul class="vulnerability-list">
                            ${Object.entries(headers).map(([key, value]) => `
                                <li class="vulnerability-item ${value === 'Not Detected' ? 'severity-high' : 'severity-low'}">
                                    ${key}: ${value}
                                </li>
                            `).join('')}
                        </ul>
                    </div>

                    <div class="compliance-section">
                        <h2>Compliance Checks</h2>
                        ${Object.entries(pciCompliance['PCI-DSS Requirements']).map(([category, requirements]) => `
                            <div class="compliance-header">
                                <h3>${category}</h3>
                            </div>
                            <div class="compliance-details">
                                ${Object.entries(requirements).map(([req, check]) => `
                                    <div class="requirement-item requirement-${check.status || 'warning'}">
                                        <strong>${req}:</strong> ${check.details || check}
                                        ${check.remediation ? `
                                            <div class="remediation-guide">
                                                <h5>Remediation Steps:</h5>
                                                <ol class="remediation-steps">
                                                    ${check.remediation.steps.map(step => `<li>${step}</li>`).join('')}
                                                </ol>
                                                <div class="documentation-links">
                                                    ${check.remediation.docs.map(doc => 
                                                        `<a href="${doc.url}" target="_blank">${doc.name}</a><br>`
                                                    ).join('')}
                                                </div>
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        `).join('')}
                    </div>

                    <div class="compliance-section">
                        <h2>Compliance Documentation</h2>
                        ${Object.entries(complianceDocs).map(([standard, docs]) => `
                            <div class="compliance-header">
                                <h3>${standard} Documentation</h3>
                            </div>
                            <div class="compliance-details">
                                <div class="documentation-links">
                                    ${Object.entries(docs).map(([type, url]) => `
                                        <a href="${url}" target="_blank">${type.charAt(0).toUpperCase() + type.slice(1)} Documentation</a><br>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } catch (error) {
                console.error('Security scan error:', error);
                securityStatus = `
                    <div class="error-message">
                        <h3>Error during security scan</h3>
                        <p>An error occurred while performing the security scan. Please check the console for more details.</p>
                        <p>Error details: ${error.message}</p>
                    </div>
                `;
            }

            securityScan.innerHTML = securityStatus;
        }

        // Function to parse and display cookies
        function displayCookies() {
            const cookieListDiv = document.getElementById('cookie-list');
            const cookies = document.cookie ? document.cookie.split('; ') : [];
            if (cookies.length === 0 || (cookies.length === 1 && cookies[0] === '')) {
                cookieListDiv.innerHTML = '<em>No accessible cookies found.</em>';
                return;
            }
            let html = '<table style="width:100%;border-collapse:collapse;">';
            html += '<tr style="background:#f5f5f5;"><th style="text-align:left;padding:6px;">Name</th><th style="text-align:left;padding:6px;">Value</th><th style="text-align:left;padding:6px;">Details</th></tr>';
            cookies.forEach(cookieStr => {
                const eqIdx = cookieStr.indexOf('=');
                const name = eqIdx > -1 ? cookieStr.substring(0, eqIdx) : cookieStr;
                const value = eqIdx > -1 ? decodeURIComponent(cookieStr.substring(eqIdx + 1)) : '';
                html += `<tr style="border-bottom:1px solid #eee;">
                    <td style="padding:6px;word-break:break-all;">${name}</td>
                    <td style="padding:6px;word-break:break-all;">${value}</td>
                    <td style="padding:6px;">
                        <span style='background:#e7f4e4;color:#256029;padding:2px 8px;border-radius:12px;font-size:0.9em;'>First-party</span>
                        Accessible via JavaScript
                    </td>
                </tr>`;
            });
            html += '</table>';
            cookieListDiv.innerHTML = html;
        }

        // Accordion toggle function
        function toggleAccordion(id) {
            const panel = document.getElementById(id);
            const isOpen = panel.classList.contains('open');
            document.querySelectorAll('.accordion').forEach(acc => acc.classList.remove('open'));
            if (!isOpen) panel.classList.add('open');
        }

        // Add privacy protection display (reuse privacy info from checkPrivacy)
        function displayPrivacyProtection() {
            const privacyDiv = document.getElementById('privacy-protection-list');
            if (!privacyDiv) return;
            checkPrivacy().then(privacy => {
                let html = '<table style="width:100%;border-collapse:collapse;">';
                html += '<tr style="background:#f5f5f5;"><th style="text-align:left;padding:6px;">Feature</th><th style="text-align:left;padding:6px;">Status</th></tr>';
                Object.entries(privacy).forEach(([key, value]) => {
                    html += `<tr style="border-bottom:1px solid #eee;">
                        <td style="padding:6px;">${key}</td>
                        <td style="padding:6px;">${value}</td>
                    </tr>`;
                });
                html += '</table>';
                privacyDiv.innerHTML = html;
            });
        }

        // Initialize all functions when the page loads
        window.onload = function() {
            getIPAddress();
            getBrowserInfo();
            getGeolocation();
            performSecurityScan();
            displayCookies();
            displayPrivacyProtection();
        };
    </script>
    <!-- Add Google Maps JavaScript API -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCs5JiyJ5BP6bA2KL-BrxNja61psUKmWI4">
    </script>
</body>
</html> 